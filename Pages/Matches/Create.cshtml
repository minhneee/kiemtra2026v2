@page
@model PickleballClubManagement.Pages.Matches.CreateModel
@{
    ViewData["Title"] = "Nh·∫≠p K·∫øt Qu·∫£ Tr·∫≠n ƒê·∫•u";
}

<style>
    .match-hero {
        background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
        color: var(--color-white);
        padding: 3rem var(--spacing-lg);
        border-radius: var(--radius-lg);
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(22, 163, 74, 0.2);
    }

    .match-hero h1 {
        font-size: 2.5rem;
        font-weight: 900;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .match-hero p {
        margin: 0.5rem 0 0;
        opacity: 0.95;
        font-size: 1.1rem;
    }

    .form-section {
        background: var(--color-white);
        border: 1px solid var(--color-gray-200);
        border-radius: var(--radius-lg);
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .form-section-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--color-primary);
    }

    .section-number {
        background: var(--gradient-primary);
        color: var(--color-white);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 900;
        font-size: 1.2rem;
    }

    .section-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--color-gray-900);
    }

    .format-options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .format-card {
        border: 2px solid var(--color-gray-200);
        border-radius: var(--radius-md);
        padding: 1.5rem;
        text-align: center;
        cursor: pointer;
        transition: all var(--transition-base);
    }

    .format-card:hover {
        border-color: var(--color-primary);
        background: rgba(22, 163, 74, 0.05);
    }

    .format-card input[type="radio"] {
        display: none;
    }

    .format-card input[type="radio"]:checked + div {
        color: var(--color-gray-900);
    }

    .format-card input[type="radio"]:checked ~ .format-content {
        background: var(--gradient-primary);
        color: var(--color-gray-900);
    }

    .format-content {
        padding: 1rem;
        border-radius: var(--radius-md);
        background: var(--color-gray-50);
        transition: all var(--transition-base);
        color: var(--color-gray-900);
    }

    .format-emoji {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
    }

    .format-label {
        font-weight: 700;
        font-size: 1.1rem;
        margin-bottom: 0.25rem;
        color: var(--color-gray-900);
    }

    .format-desc {
        font-size: 0.85rem;
        color: var(--color-gray-600);
    }

    .team-section {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 1.5rem;
        align-items: flex-start;
    }

    .team-column h4 {
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 1rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid var(--color-gray-300);
    }

    .team-column.winner h4 {
        color: #16A34A;
        border-bottom-color: #16A34A;
    }

    .team-column.loser h4 {
        color: #EF4444;
        border-bottom-color: #EF4444;
    }

    .vs-divider {
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 900;
        font-size: 1.3rem;
        color: var(--color-primary);
        padding: 2rem 0;
    }

    .form-section-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .option-card {
        border: 1px solid var(--color-gray-200);
        border-radius: var(--radius-md);
        padding: 1rem;
        background: var(--color-gray-50);
        display: flex;
        align-items: center;
        gap: 0.75rem;
        transition: all var(--transition-base);
    }

    .option-card:hover {
        background: rgba(22, 163, 74, 0.05);
        border-color: var(--color-primary);
    }

    .option-card input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }

    .option-card label {
        margin: 0;
        cursor: pointer;
        flex: 1;
    }

    .button-group {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 1px solid var(--color-gray-200);
    }

    @@media (max-width: 768px) {
        .match-hero h1 {
            font-size: 1.8rem;
        }

        .format-options {
            grid-template-columns: 1fr;
        }

        .team-section {
            grid-template-columns: 1fr;
        }

        .vs-divider {
            padding: 1rem 0;
        }

        .form-section {
            padding: 1.5rem;
        }

        .button-group {
            flex-direction: column-reverse;
        }

        .button-group .btn {
            width: 100%;
        }
    }
</style>

<div class="match-hero">
    <h1>‚öñÔ∏è Nh·∫≠p K·∫øt Qu·∫£ Tr·∫≠n ƒê·∫•u</h1>
    <p>Ghi nh·∫≠n k·∫øt qu·∫£ tr·∫≠n ƒë·∫•u v√† c·∫≠p nh·∫≠t ƒëi·ªÉm x·∫øp h·∫°ng</p>
</div>

<form method="post" id="matchForm" style="max-width: 1000px; margin: 0 auto;">
    <!-- Step 1: Format -->
    <!-- Step 1: Format -->
    <div class="form-section">
        <div class="form-section-header">
            <div class="section-number">1</div>
            <div class="section-title">Ch·ªçn Lo·∫°i Tr·∫≠n ƒê·∫•u</div>
        </div>
        <div class="format-options">
            <label class="format-card">
                <input type="radio" asp-for="Input.Format" value="0" checked />
                <div>
                    <div class="format-content">
                        <div class="format-emoji">üéæ</div>
                        <div class="format-label">ƒê∆†N</div>
                        <div class="format-desc">1 vs 1</div>
                    </div>
                </div>
            </label>
            <label class="format-card">
                <input type="radio" asp-for="Input.Format" value="1" />
                <div>
                    <div class="format-content">
                        <div class="format-emoji">üéæüéæ</div>
                        <div class="format-label">ƒê√îI</div>
                        <div class="format-desc">2 vs 2</div>
                    </div>
                </div>
            </label>
        </div>
    </div>

    <!-- Step 2: Challenge -->
    <div class="form-section">
        <div class="form-section-header">
            <div class="section-number">2</div>
            <div class="section-title">K√®o Li√™n Quan</div>
        </div>
        <div class="form-group">
            <select class="form-control" asp-for="Input.ChallengeId" style="font-size: 1rem; padding: 0.75rem;">
                <option value="">-- Kh√¥ng c√≥ k√®o (ƒê√°nh t·ª± do) --</option>
                @foreach (var challenge in Model.AcceptedChallenges)
                {
                    <option value="@challenge.Id">@challenge.Title (@challenge.Creator?.FullName)</option>
                }
            </select>
        </div>
    </div>

    <!-- Step 3: Players -->
    <div class="form-section">
        <div class="form-section-header">
            <div class="section-number">3</div>
            <div class="section-title">Ch·ªçn Ng∆∞·ªùi Ch∆°i</div>
        </div>
        <div class="team-section">
            <div class="team-column winner">
                <h4>üèÜ TH·∫ÆNG</h4>
                <div class="form-group">
                    <select class="form-control" asp-for="Input.Winner1Id" required style="font-size: 0.95rem;">
                        <option value="">-- Ch·ªçn ng∆∞·ªùi ch∆°i --</option>
                        @foreach (var member in Model.Members)
                        {
                            <option value="@member.Id">@member.FullName (‚≠ê @member.RankLevel.ToString("F1"))</option>
                        }
                    </select>
                </div>
                <div class="form-group" id="winner2Group" style="display: none;">
                    <select class="form-control" asp-for="Input.Winner2Id" style="font-size: 0.95rem;">
                        <option value="">-- Ch·ªçn ng∆∞·ªùi ch∆°i 2 --</option>
                        @foreach (var member in Model.Members)
                        {
                            <option value="@member.Id">@member.FullName (‚≠ê @member.RankLevel.ToString("F1"))</option>
                        }
                    </select>
                </div>
            </div>

            <div class="vs-divider">VS</div>

            <div class="team-column loser">
                <h4>‚ùå THUA</h4>
                <div class="form-group">
                    <select class="form-control" asp-for="Input.Loser1Id" required style="font-size: 0.95rem;">
                        <option value="">-- Ch·ªçn ng∆∞·ªùi ch∆°i --</option>
                        @foreach (var member in Model.Members)
                        {
                            <option value="@member.Id">@member.FullName (‚≠ê @member.RankLevel.ToString("F1"))</option>
                        }
                    </select>
                </div>
                <div class="form-group" id="loser2Group" style="display: none;">
                    <select class="form-control" asp-for="Input.Loser2Id" style="font-size: 0.95rem;">
                        <option value="">-- Ch·ªçn ng∆∞·ªùi ch∆°i 2 --</option>
                        @foreach (var member in Model.Members)
                        {
                            <option value="@member.Id">@member.FullName (‚≠ê @member.RankLevel.ToString("F1"))</option>
                        }
                    </select>
                </div>
            </div>
        </div>
        <div asp-validation-summary="ModelOnly" class="text-danger mt-2"></div>
    </div>

    <!-- Step 4: Options -->
    <div class="form-section">
        <div class="form-section-header">
            <div class="section-number">4</div>
            <div class="section-title">T√πy Ch·ªçn B·ªï Sung</div>
        </div>
        <label class="option-card">
            <input type="checkbox" asp-for="Input.IsRanked" checked />
            <label style="margin: 0; cursor: pointer;">
                <strong>‚≠ê T√≠nh ƒêi·ªÉm Rank</strong>
                <div style="font-size: 0.85rem; color: var(--color-gray-600); margin-top: 0.25rem;">
                    Th·∫Øng +0.1 ƒëi·ªÉm, Thua -0.1 ƒëi·ªÉm
                </div>
            </label>
        </label>
    </div>

    <div class="button-group">
        <a href="/" class="btn btn-secondary">‚Ü©Ô∏è H·ªßy</a>
        <button type="submit" class="btn btn-primary">üíæ L∆∞u K·∫øt Qu·∫£</button>
    </div>
</form>

@section Scripts {
    <script>
        // Show/hide player 2 fields based on format
        const formatRadios = document.querySelectorAll('input[name="Input.Format"]');
        const winner2Group = document.getElementById('winner2Group');
        const loser2Group = document.getElementById('loser2Group');

        function updatePlayerFields() {
            const isSingles = document.querySelector('input[name="Input.Format"]:checked').value === '0';
            winner2Group.style.display = isSingles ? 'none' : 'block';
            loser2Group.style.display = isSingles ? 'none' : 'block';
            
            if (isSingles) {
                document.querySelector('select[name="Input.Winner2Id"]').value = '';
                document.querySelector('select[name="Input.Loser2Id"]').value = '';
            }
        }

        formatRadios.forEach(radio => {
            radio.addEventListener('change', updatePlayerFields);
        });

        // Validation: Check for duplicate players
        document.getElementById('matchForm').addEventListener('submit', function(e) {
            const winner1 = document.querySelector('select[name="Input.Winner1Id"]').value;
            const winner2 = document.querySelector('select[name="Input.Winner2Id"]').value;
            const loser1 = document.querySelector('select[name="Input.Loser1Id"]').value;
            const loser2 = document.querySelector('select[name="Input.Loser2Id"]').value;

            const players = [winner1, winner2, loser1, loser2].filter(p => p !== '');
            const uniquePlayers = new Set(players);

            if (players.length !== uniquePlayers.size) {
                e.preventDefault();
                alert('‚ö†Ô∏è L·ªói: M·ªôt ng∆∞·ªùi kh√¥ng th·ªÉ v·ª´a th·∫Øng v·ª´a thua, ho·∫∑c xu·∫•t hi·ªán nhi·ªÅu l·∫ßn!');
                return false;
            }
        });
    </script>
    <partial name="_ValidationScriptsPartial" />
}
