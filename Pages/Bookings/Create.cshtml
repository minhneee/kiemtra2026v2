@page
@model PickleballClubManagement.Pages.Bookings.CreateModel
@{
    ViewData["Title"] = "ƒê·∫∑t S√¢n";
}

<style>
    .booking-hero {
        background: linear-gradient(135deg, #3B82F6 0%, #8B5CF6 100%);
        color: var(--color-white);
        padding: 3rem var(--spacing-lg);
        border-radius: var(--radius-lg);
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
    }

    .booking-hero h1 {
        font-size: 2.5rem;
        font-weight: 900;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .booking-hero p {
        margin: 0.5rem 0 0;
        opacity: 0.95;
        font-size: 1.1rem;
    }

    .booking-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .booking-form-card {
        background: var(--color-white);
        border: 1px solid var(--color-gray-200);
        border-radius: var(--radius-lg);
        padding: 2rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .booking-form-title {
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: var(--color-gray-900);
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--color-primary);
    }

    .form-section {
        margin-bottom: 1.25rem;
    }

    .form-label {
        display: block;
        margin-bottom: 0.6rem;
        font-weight: 600;
        color: var(--color-gray-800);
        font-size: 0.95rem;
    }

    .form-control {
        width: 100%;
        padding: 0.85rem;
        border: 1px solid var(--color-gray-300);
        border-radius: var(--radius-md);
        font-size: 1rem;
        color: var(--color-gray-900);
        background: var(--color-white);
        transition: all var(--transition-base);
    }

    .form-control:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 3px rgba(22, 163, 74, 0.1);
    }

    .time-inputs {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .alert {
        padding: 1rem;
        border-radius: var(--radius-md);
        margin-bottom: 1.5rem;
        border-left: 4px solid;
    }

    .alert-error {
        background: #FEE2E2;
        border-color: #DC2626;
        color: #991B1B;
    }

    .alert-success {
        background: #DCFCE7;
        border-color: #16A34A;
        color: #166534;
    }

    .btn {
        padding: 0.85rem 1.5rem;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 0.95rem;
        cursor: pointer;
        border: none;
        transition: all var(--transition-base);
        width: 100%;
    }

    .btn-primary {
        background: var(--gradient-primary);
        color: var(--color-white);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(22, 163, 74, 0.3);
    }

    .schedule-title {
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: var(--color-gray-900);
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--color-primary);
    }

    .schedule-item {
        padding: 1rem;
        background: var(--color-gray-50);
        border-radius: var(--radius-md);
        border-left: 4px solid var(--color-primary);
        margin-bottom: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all var(--transition-base);
    }

    .schedule-item:hover {
        background: rgba(22, 163, 74, 0.05);
        border-left-color: var(--color-accent);
    }

    .schedule-time {
        font-weight: 700;
        font-size: 1.05rem;
        color: var(--color-primary);
    }

    .schedule-member {
        color: var(--color-gray-700);
        font-size: 0.9rem;
    }

    .schedule-empty {
        text-align: center;
        padding: 2rem;
        color: var(--color-gray-600);
    }

    .status-badge {
        padding: 0.4rem 0.9rem;
        border-radius: var(--radius-sm);
        font-size: 0.8rem;
        font-weight: 700;
        background: #DCFCE7;
        color: #166534;
    }

    .validation-error {
        color: #DC2626;
        font-size: 0.85rem;
        margin-top: 0.3rem;
    }

    @@media (max-width: 1024px) {
        .booking-container {
            grid-template-columns: 1fr;
        }
    }

    @@media (max-width: 768px) {
        .booking-hero h1 {
            font-size: 1.8rem;
        }

        .booking-form-card {
            padding: 1.5rem;
        }

        .time-inputs {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="booking-hero">
    <h1>üìÖ ƒê·∫∑t S√¢n CLB</h1>
    <p>ƒê·∫∑t s√¢n ƒë·ªÉ t·∫≠p luy·ªán ho·∫∑c t·ªï ch·ª©c c√°c ho·∫°t ƒë·ªông</p>
</div>

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-error">
        ‚ùå @TempData["ErrorMessage"]
    </div>
}
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">
        ‚úÖ @TempData["SuccessMessage"]
    </div>
}

<div class="booking-container">
    <!-- Booking Form -->
    <div class="booking-form-card">
        <h2 class="booking-form-title">üìù ƒê·∫∑t S√¢n M·ªõi</h2>
        
        <form method="post">
            @{
                var modelState = ViewData.ModelState;
                var hasErrors = modelState?.Any(x => x.Value?.Errors.Count > 0) ?? false;
            }

            @if (hasErrors)
            {
                <div class="alert alert-error" style="margin-bottom: 1.5rem;">
                    <strong>‚ö†Ô∏è C√≥ l·ªói trong bi·ªÉu m·∫´u</strong>
                </div>
            }
            
            <div class="form-section">
                <label class="form-label">üèüÔ∏è Ch·ªçn S√¢n</label>
                <select class="form-control @(modelState?["Input.CourtId"]?.Errors.Count > 0 ? "error" : "")" asp-for="Input.CourtId">
                    <option value="">-- Ch·ªçn s√¢n --</option>
                    @foreach (var court in Model.Courts)
                    {
                        <option value="@court.Id">üèüÔ∏è @court.Name</option>
                    }
                </select>
                @if (modelState?["Input.CourtId"]?.Errors.FirstOrDefault() != null)
                {
                    <span class="validation-error">@modelState["Input.CourtId"].Errors.First().ErrorMessage</span>
                }
            </div>

            <div class="form-section">
                <label class="form-label">üìÖ Ng√†y ƒê·∫∑t S√¢n</label>
                <input class="form-control @(modelState?["Input.Date"]?.Errors.Count > 0 ? "error" : "")" asp-for="Input.Date" type="date" min="@DateTime.Now.ToString("yyyy-MM-dd")" />
                @if (modelState?["Input.Date"]?.Errors.FirstOrDefault() != null)
                {
                    <span class="validation-error">@modelState["Input.Date"].Errors.First().ErrorMessage</span>
                }
            </div>

            <div class="form-section">
                <label class="form-label">‚è∞ Th·ªùi Gian</label>
                <div class="time-inputs">
                    <div>
                        <label class="form-label" style="font-size: 0.9rem; margin-bottom: 0.4rem;">Gi·ªù B·∫Øt ƒê·∫ßu</label>
                        <input class="form-control @(modelState?["Input.StartTime"]?.Errors.Count > 0 ? "error" : "")" asp-for="Input.StartTime" type="time" />
                        @if (modelState?["Input.StartTime"]?.Errors.FirstOrDefault() != null)
                        {
                            <span class="validation-error">@modelState["Input.StartTime"].Errors.First().ErrorMessage</span>
                        }
                    </div>
                    <div>
                        <label class="form-label" style="font-size: 0.9rem; margin-bottom: 0.4rem;">Gi·ªù K·∫øt Th√∫c</label>
                        <input class="form-control @(modelState?["Input.EndTime"]?.Errors.Count > 0 ? "error" : "")" asp-for="Input.EndTime" type="time" />
                        @if (modelState?["Input.EndTime"]?.Errors.FirstOrDefault() != null)
                        {
                            <span class="validation-error">@modelState["Input.EndTime"].Errors.First().ErrorMessage</span>
                        }
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <label class="form-label">üìù Ghi Ch√∫ (T√πy ch·ªçn)</label>
                <textarea class="form-control @(modelState?["Input.Notes"]?.Errors.Count > 0 ? "error" : "")" asp-for="Input.Notes" rows="2" placeholder="V√≠ d·ª•: ƒê√°nh gi·∫£i mini, c·∫ßn thu√™ v·ª£t..."></textarea>
                @if (modelState?["Input.Notes"]?.Errors.FirstOrDefault() != null)
                {
                    <span class="validation-error">@modelState["Input.Notes"].Errors.First().ErrorMessage</span>
                }
            </div>

            <button type="submit" class="btn btn-primary" style="margin-top: 1rem;">
                ‚úÖ X√°c Nh·∫≠n ƒê·∫∑t S√¢n
            </button>
        </form>
    </div>
    
    <!-- Today's Schedule -->
    <div class="booking-form-card">
        <h2 class="schedule-title">üìä L·ªãch S√¢n H√¥m Nay</h2>
        
        @if (Model.TodayBookings.Any())
        {
            var groupedBookings = Model.TodayBookings.GroupBy(b => b.Court?.Name ?? "S√¢n Kh√°c");
            
            @foreach (var group in groupedBookings)
            {
                <div style="margin-bottom: 1.5rem;">
                    <div style="font-weight: 600; color: var(--color-primary); margin-bottom: 0.75rem; font-size: 1rem;">
                        üèüÔ∏è @group.Key
                    </div>
                    
                    @foreach (var booking in group.OrderBy(b => b.StartTime))
                    {
                        <div class="schedule-item">
                            <div>
                                <div class="schedule-time">
                                    ‚è∞ @booking.StartTime.ToString("HH:mm") - @booking.EndTime.ToString("HH:mm")
                                </div>
                                <div class="schedule-member">
                                    üë§ @booking.Member?.FullName @(booking.Notes != null ? "üìù" : "")
                                </div>
                            </div>
                            <span class="status-badge">ƒê√£ ƒê·∫∑t</span>
                        </div>
                    }
                </div>
            }
        }
        else
        {
            <div class="schedule-empty">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">üì≠</div>
                <p>H√¥m nay ch∆∞a c√≥ l·ªãch ƒë·∫∑t s√¢n n√†o</p>
            </div>
        }
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
